{% extends 'sign.html' %}

{% block sign %}

    {% if not settings.testMode %}

        <table cellspacing="0">
            <tr>
                <td class="heacer c0" id="header c0">TRUCK</td>
                <td class="header c1" id="header c1">DOOR</td>
            </tr>

            {% for obj in objects %}
                {% if not obj.userOverride %}  

                    <tr>
                        <td class="c0" id="r{{forloop.counter0}}c0" name="msg{{obj.msgNum}}TuNumExt">{{ obj.tuNumExt }}</td>
                        <td class="c1" id="r{{forloop.counter0}}c1" name="msg{{obj.msgNum}}Door">{{ obj.door }}</td>
                    </tr>

                {% else %} 

                    <tr>
                        <td class="scrollCol" colspan="2" id="r{{forloop.counter0}}c0" name="msg{{obj.msgNum}}TuNumExt">
                            <div class="scroll-left">
                                <p name="msg{{obj.msgNum}}TuNumExt">{{ obj.tuNumExt }}</p>
                            </div>
                        </td>
                    </tr>

                {% endif %}
            {% endfor %}

        </table>

        <script>

            function changeTextColor(elements, textColor){
                for (var j=0; j<elements.length; j++){
                    elements[j].style.color = textColor;
                }

            }

            function addFlashingClass(elements){
                for (var j=0; j<elements.length; j++){
                    elements[j].classList.add("flashing")
                }

            }

            var json_data = JSON.parse("{{as_json|escapejs}}");
            var object_list =  json_data["objects"];
            var settings = json_data["settings"];
            var textColor = settings["textColor"];
            var elements = document.getElementsByTagName("td");
            changeTextColor(elements, textColor);
            elements = document.getElementsByTagName("p");
            changeTextColor(elements, textColor);
            for (var i=0; i<object_list.length; i++){
                var msgNum = object_list[i]["msgNum"];
                textColor = object_list[i]["textColor"];
                var colorOverride = object_list[i]["textColorOverride"];
                var isFlashing = object_list[i]["isFlashing"];
                var cellTuNumExt = document.getElementsByName("msg"+msgNum+"TuNumExt");
                var cellDoor = document.getElementsByName("msg"+msgNum+"Door");
                if (colorOverride){
                    changeTextColor(cellTuNumExt, textColor);
                    changeTextColor(cellDoor, textColor);
                }
                if (isFlashing){
                    addFlashingClass(cellTuNumExt);
                    addFlashingClass(cellDoor);
                }
            }
            document.body.style.backgroundColor = settings.bgColor;

        </script>

    {% else %}

        <style>
            table{
                border-spacing: 0px;
                table-layout: fixed;
            }
            .c{
                font-size: 1px;
                overflow: hidden;
            }
        </style>
        <table height="100%" cellspacing="0">
            <tr>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
                <td class="c" width="10px"></td>
            </tr>
        </table>
        <script>
            window.onload = () => {
                startSetTimeoutAnimation();
            };

            function startSetTimeoutAnimation() {
                let colors = [
                    "#FF0000", "#FF1100", "#FF2200", "#FF3300", "#FF4400", "#FF5500", "#FF6600", "#FF7700", "#FF8800", "#FF9900", "#FFAA00", "#FFBB00", "#FFCC00", "#FFDD00", "#FFEE00",
                    "#FFFF00", "#EEFF00", "#DDFF00", "#CCFF00", "#BBFF00", "#AAFF00", "#99FF00", "#88FF00", "#77FF00", "#66FF00", "#55FF00", "#44FF00", "#33FF00", "#22FF00", "#11FF00",
                    "#00FF00", "#00FF11", "#00FF22", "#00FF33", "#00FF44", "#00FF55", "#00FF66", "#00FF77", "#00FF88", "#00FF99", "#00FFAA", "#00FFBB", "#00FFCC", "#00FFDD", "#00FFEE",
                    "#00FFFF", "#00EEFF", "#00DDFF", "#00CCFF", "#00BBFF", "#00AAFF", "#0099FF", "#0088FF", "#0077FF", "#0066FF", "#0055FF", "#0044FF", "#0033FF", "#0022FF", "#0011FF",
                    "#0000FF", "#1100FF", "#2200FF", "#3300FF", "#4400FF", "#5500FF", "#6600FF", "#7700FF", "#8800FF", "#9900FF", "#AA00FF", "#BB00FF", "#CC00FF", "#DD00FF", "#EE00FF",
                    "#FF00FF", "#FF00EE", "#FF00DD", "#FF00CC", "#FF00BB", "#FF00AA", "#FF0099", "#FF0088", "#FF0077", "#FF0066", "#FF0055", "#FF0044", "#FF0033", "#FF0022", "#FF0011",
                    "#FF0000", "#EE0000", "#DD0000", "#CC0000", "#BB0000", "#AA0000", "#990000", "#880000", "#770000", "#660000", "#550000", "#440000", "#330000", "#220000", "#110000",
                    "#000000", "#111111", "#222222", "#333333", "#444444", "#555555", "#666666", "#777777", "#888888", "#999999", "#AAAAAA", "#BBBBBB", "#CCCCCC", "#DDDDDD", "#EEEEEE",
                    "#FFFFFF", "#FFEEEE", "#FFDDDD", "#FFCCCC", "#FFBBBB", "#FFAAAA", "#FF9999", "#FF8888", "#FF7777", "#FF6666", "#FF5555", "#FF4444", "#FF3333", "#FF2222", "#FF1111",
                ];
                cells = document.getElementsByClassName("c");
                let colorVal = colors.length - 1;
                let colorChanger = -1;
                for (var i = 0; i < cells.length; i++){
                    let thisCell = cells[i];
                    thisCell.innerHTML = colorVal.toString();
                    colorVal += colorChanger;
                    if (colorVal >= colors.length){
                        colorChanger = -1;
                        colorVal = colors.length - 1;
                    }
                    if (colorVal <= -1) {
                        colorChanger = 1;
                        colorVal = 1;
                    }
                }
                const dwellTime = 5;
                const fps = 60;
                const refreshRate = 1000/fps;
                var counter = 0;
                var mode = 'white';
                window.setInterval(() => {
                    cells = document.getElementsByClassName("c");
                    let color = "#FFFFFF";
                    for (var i = 0; i < cells.length; i++){
                        let thisCell = cells[i];
                        if (mode == 'rainbow'){
                            let colorVal = parseInt(thisCell.innerHTML);
                            colorVal += 1; 
                            if (colorVal >= colors.length) {
                                colorVal = 0;
                            }
                            thisCell.innerHTML = colorVal.toString();
                            color = colors[colorVal];
                        }
                        thisCell.style.backgroundColor = color;
                        thisCell.style.color = color;
                    }
                    counter += 1;
                    if (counter >= dwellTime * fps) {
                        counter = 0;
                        switch (mode){
                            case 'white':
                                mode = 'rainbow';
                                break;
                            case 'rainbow':
                                mode = 'white';
                                break;
                        }
                    } 
                    }, refreshRate);
            }

        </script>
        
    {% endif %}

{% endblock sign %}